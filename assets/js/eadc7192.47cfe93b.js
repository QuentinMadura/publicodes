"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[529],{5318:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(7378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(n),c=r,k=d["".concat(s,".").concat(c)]||d[c]||m[c]||i;return n?a.createElement(k,l(l({ref:t},p),{},{components:n})):a.createElement(k,l({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},2008:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=n(5773),r=(n(7378),n(5318));const i={sidebar_position:2,title:"Core"},l="API du paquet publicodes",o={unversionedId:"api/core",id:"api/core",title:"Core",description:"Publicodes est encore en version beta, et l'API peut-\xeatre sujette \xe0 des changements cassants lors de prochaines versions.",source:"@site/docs/api/core.mdx",sourceDirName:"api",slug:"/api/core",permalink:"/docs/api/core",draft:!1,editUrl:"https://github.com/betagouv/publicodes/edit/master/website/docs/api/core.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Core"},sidebar:"tutorialSidebar",previous:{title:"Liste des m\xe9canismes",permalink:"/docs/api/m\xe9canismes"},next:{title:"React-ui",permalink:"/docs/api/react-ui"}},s={},u=[{value:"<em>new</em> <code>Engine(rules)</code>",id:"new-enginerules",level:2},{value:"<em>method</em> <code>engine.setSituation(situation)</code>",id:"method-enginesetsituationsituation",level:3},{value:"<em>method</em> <code>engine.evaluate(expression)</code>",id:"method-engineevaluateexpression",level:3},{value:"<em>function</em> <code>formatValue(evaluatedNode, [options])</code>",id:"function-formatvalueevaluatednode-options",level:2}],p={toc:u},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"api-du-paquet-publicodes"},"API du paquet ",(0,r.kt)("inlineCode",{parentName:"h1"},"publicodes")),(0,r.kt)("admonition",{title:"Attention",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Publicodes est encore en version beta, et l'API peut-\xeatre sujette \xe0 des changements cassants lors de prochaines versions.")),(0,r.kt)("h2",{id:"new-enginerules"},(0,r.kt)("em",{parentName:"h2"},"new")," ",(0,r.kt)("inlineCode",{parentName:"h2"},"Engine(rules)")),(0,r.kt)("p",null,"Cr\xe9e un moteur d'\xe9valuation avec les r\xe8gles publicodes donn\xe9es en argument."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Arguments")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"rules")," : les r\xe8gles publicodes utilis\xe9es. Ces derni\xe8res doivent \xeatre sous la\nforme d'un objet javascript respectant la syntaxe publicodes. Elle peuvent aussi \xeatre sous la forme de r\xe8gles publicodes d\xe9j\xe0 pars\xe9es.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"publicodes n'accepte plus en entr\xe9e une cha\xeene de caract\xe8res YAML, car le parser YAML alourdissait beaucoup la biblitoth\xe8que")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Retourne"),"\nUn moteur d'\xe9valuation qui expose les fonctions suivantes :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setSituation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"evaluate")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getRule")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getParsedRules"))),(0,r.kt)("h3",{id:"method-enginesetsituationsituation"},(0,r.kt)("em",{parentName:"h3"},"method")," ",(0,r.kt)("inlineCode",{parentName:"h3"},"engine.setSituation(situation)")),(0,r.kt)("p",null,"Permet de sp\xe9cifier une situation en entr\xe9e. Toutes les prochaines \xe9valuations\nseront effectu\xe9es en se basant sur ces valeurs plut\xf4t que les valeurs pr\xe9sentes\ndans la base de r\xe8gles."),(0,r.kt)("p",null,"C'est le point d'entr\xe9e principal pour adapter les calculs de r\xe8gles g\xe9n\xe9rales \xe0\nune situation particuli\xe8re. La situation est gard\xe9e en m\xe9moire, et chaque appel\n\xe0 ",(0,r.kt)("inlineCode",{parentName:"p"},"setSituation")," remplace la situation pr\xe9c\xe9dente. Le moteur\ncontient donc un ",(0,r.kt)("em",{parentName:"p"},"\xe9tat interne"),". Cela permet d'obtenir de meilleures performances,\navec une gestion plus fine du cache de calcul."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Arguments")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"situation")," : un objet javascript qui associe le nom complet d'une r\xe8gle \xe0 sa\nvaleur. Cette valeur peut \xeatre n'importe quelle expression publicodes bien form\xe9e.\nElle sera \xe9valu\xe9e par le moteur. Cela permet de sp\xe9cifier des nombres avec unit\xe9,\ndes expressions, des r\xe9f\xe9rences vers d'autres r\xe8gles ou m\xeame d'utiliser des m\xe9canismes.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"options")," : Param\xe8tres optionnels sous forme d'objet"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"keepPreviousSituation")," : par d\xe9faut, l'appel \xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"setSituation")," \xe9crase la situation\npr\xe9cedemment renseign\xe9e. Pour faire une mise \xe0 jour en gardant l'\xe9tat en cours, il\nsuffit de mettre ce param\xe8tre \xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),".")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Retourne"),"\nL'objet engine (",(0,r.kt)("inlineCode",{parentName:"p"},"this"),") sur lequel la fonction a \xe9t\xe9 appel\xe9e, afin de pouvoir\nutiliser une \xe9criture cha\xeen\xe9e (",(0,r.kt)("inlineCode",{parentName:"p"},"engine.setSituation(situation).evaluate()"),")."),(0,r.kt)("h3",{id:"method-engineevaluateexpression"},(0,r.kt)("em",{parentName:"h3"},"method")," ",(0,r.kt)("inlineCode",{parentName:"h3"},"engine.evaluate(expression)")),(0,r.kt)("p",null,"\xc9value l'expression dans le contexte du moteur (r\xe8gle et situation)."),(0,r.kt)("p",null,"Pour des raisons de performance, les r\xe9sultats interm\xe9diaires sont enregistr\xe9s\ndans un cache. Par cons\xe9quent, les appels suivants seront plus rapides."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Arguments")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"expression"),": la valeur \xe0 \xe9valuer. Cela peut-\xeatre n'importe quelle expression publicodes\nbien form\xe9e (expression arithm\xe9tique, m\xe9canisme, r\xe9ference vers une r\xe8gle).")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Retourne")),(0,r.kt)("p",null,"Un objet javascript de type ",(0,r.kt)("inlineCode",{parentName:"p"},"EvaluatedNode")," contenant la valeur calcul\xe9e."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"traversedVariables"),": la liste des r\xe8gles travers\xe9es lors de l'\xe9valuation de\nl'expression courante"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"missingVariables"),": contient les r\xe8gles dont la valeur est manquante dans la\nsituation"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"nodeValue"),": la valeur calcul\xe9e (type ",(0,r.kt)("inlineCode",{parentName:"li"},"string"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"number"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"boolean"),", ou ",(0,r.kt)("inlineCode",{parentName:"li"},"null"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"unit"),": si ",(0,r.kt)("inlineCode",{parentName:"li"},"nodeValue")," est un nombre, contient l'unit\xe9 associ\xe9e")),(0,r.kt)("h2",{id:"function-formatvalueevaluatednode-options"},(0,r.kt)("em",{parentName:"h2"},"function")," ",(0,r.kt)("inlineCode",{parentName:"h2"},"formatValue(evaluatedNode, [options])")),(0,r.kt)("p",null,"Formate la valeur evalu\xe9e."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Arguments")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"evaluatedNode")," : l'objet retourn\xe9 lors de l'appel \xe0 la fonction\nd'\xe9valuation du moteur ",(0,r.kt)("inlineCode",{parentName:"li"},"evaluate(expression)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"options")," : configuration pour le formatage",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"language"),": le langage utilis\xe9 pour le formatage (par d\xe9faut ",(0,r.kt)("inlineCode",{parentName:"li"},"fr"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"precision"),": le nombre de chiffre apr\xe8s la virgule pour le formatage des\nnombres (par d\xe9faut ",(0,r.kt)("inlineCode",{parentName:"li"},"2"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"displayedUnit"),": l'unit\xe9 \xe0 afficher pour le formatage des nombres.\nOutrepasse l'unit\xe9 d\xe9finie dans le calcul (on peut donc forcer l'unit\xe9\naffich\xe9e \xe0 une autre que celle retourn\xe9e par le calcul, m\xeame si elle ne sont\npas compatibles)")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Retourne")),(0,r.kt)("p",null,"La cha\xeene de caract\xe8re correspondant \xe0 la valeur bien format\xe9e."))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=eadc7192.47cfe93b.js.map