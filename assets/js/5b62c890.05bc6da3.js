"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[303],{5760:(e,n,a)=>{a.d(n,{Z:()=>u});var l=a(7052),t=a(7378),i=a(2494);const s=(0,t.lazy)((()=>Promise.all([a.e(532),a.e(588),a.e(364)]).then(a.bind(a,6364))));function u(e){let{rules:n,meta:a}=e;const[u,r]=(0,t.useState)(n.trim()),[o,p]=(0,t.useState)(!1),[m,d]=(0,t.useState)(a),c="json";return(0,t.useEffect)((()=>{o||r(n.trim())}),[o,n]),t.createElement("div",{className:i.Z.container},o?t.createElement(t.Suspense,{fallback:t.createElement("div",null,"Chargement en cours")},t.createElement(s,{language:c,defaultTarget:m,onTargetChange:d,onChange:e=>r(e)},u)):t.createElement(l.Z,{language:c},u),t.createElement("button",{className:i.Z.button,onClick:()=>p((e=>!e)),style:o?{top:0}:{bottom:0}},o?"Fermer":"\u26a1 Tester"))}},676:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>u,default:()=>c,frontMatter:()=>s,metadata:()=>r,toc:()=>p});var l=a(5773),t=(a(7378),a(5318)),i=a(5760);const s={sidebar_position:1,title:"Liste des m\xe9canismes",toc_max_heading_level:2,hide_table_of_contents:!1},u=void 0,r={unversionedId:"api/m\xe9canismes",id:"api/m\xe9canismes",title:"Liste des m\xe9canismes",description:"applicable si",source:"@site/docs/api/m\xe9canismes.mdx",sourceDirName:"api",slug:"/api/m\xe9canismes",permalink:"/docs/api/m\xe9canismes",draft:!1,editUrl:"https://github.com/betagouv/publicodes/edit/master/website/docs/api/m\xe9canismes.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Liste des m\xe9canismes",toc_max_heading_level:2,hide_table_of_contents:!1},sidebar:"tutorialSidebar",previous:{title:"Afficher la documentation avec Svelte",permalink:"/docs/guides/documentation-svelte"},next:{title:"Core",permalink:"/docs/api/core"}},o={},p=[{value:"applicable si",id:"applicable-si",level:2},{value:"Exemple",id:"exemple",level:3},{value:"non applicable si",id:"non-applicable-si",level:2},{value:"Exemple",id:"exemple-1",level:3},{value:"est non d\xe9fini",id:"est-non-d\xe9fini",level:2},{value:"Exemple",id:"exemple-2",level:3},{value:"est d\xe9fini",id:"est-d\xe9fini",level:2},{value:"Exemple",id:"exemple-3",level:3},{value:"est non applicable",id:"est-non-applicable",level:2},{value:"Exemple",id:"exemple-4",level:3},{value:"est applicable",id:"est-applicable",level:2},{value:"Exemple",id:"exemple-5",level:3},{value:"une de ces conditions",id:"une-de-ces-conditions",level:2},{value:"Exemple",id:"exemple-6",level:3},{value:"toutes ces conditions",id:"toutes-ces-conditions",level:2},{value:"Exemple",id:"exemple-7",level:3},{value:"produit",id:"produit",level:2},{value:"Utilisation",id:"utilisation",level:3},{value:"Exemple",id:"exemple-8",level:3},{value:"assiette plafonn\xe9e",id:"assiette-plafonn\xe9e",level:4},{value:"variations",id:"variations",level:2},{value:"Utilisation",id:"utilisation-1",level:3},{value:"Exemple",id:"exemple-9",level:3},{value:"Dans un autre m\xe9canisme",id:"dans-un-autre-m\xe9canisme",level:4},{value:"somme",id:"somme",level:2},{value:"Exemple",id:"exemple-10",level:3},{value:"Terme non applicable",id:"terme-non-applicable",level:4},{value:"moyenne",id:"moyenne",level:2},{value:"Exemple",id:"exemple-11",level:3},{value:"Terme non applicable",id:"terme-non-applicable-1",level:4},{value:"le maximum de",id:"le-maximum-de",level:2},{value:"Exemple",id:"exemple-12",level:3},{value:"le minimum de",id:"le-minimum-de",level:2},{value:"Exemple",id:"exemple-13",level:3},{value:"arrondi",id:"arrondi",level:2},{value:"Exemple",id:"exemple-14",level:3},{value:"Nombre de d\xe9cimales",id:"nombre-de-d\xe9cimales",level:4},{value:"recalcul",id:"recalcul",level:2},{value:"Exemple",id:"exemple-15",level:3},{value:"bar\xe8me",id:"bar\xe8me",level:2},{value:"Exemple",id:"exemple-16",level:3},{value:"Sans multiplicateur",id:"sans-multiplicateur",level:4},{value:"Avec multiplicateur",id:"avec-multiplicateur",level:4},{value:"grille",id:"grille",level:2},{value:"Exemple",id:"exemple-17",level:3},{value:"taux progressif",id:"taux-progressif",level:2},{value:"Exemple",id:"exemple-18",level:3},{value:"composantes",id:"composantes",level:2},{value:"Exemple",id:"exemple-19",level:3},{value:"Calcul de cotisation avec part salariale et patronale",id:"calcul-de-cotisation-avec-part-salariale-et-patronale",level:4},{value:"Prix HT et TVA",id:"prix-ht-et-tva",level:4},{value:"abattement",id:"abattement",level:2},{value:"Exemple",id:"exemple-20",level:3},{value:"Abattement simple",id:"abattement-simple",level:4},{value:"Abattement sup\xe9rieur \xe0 la valeur",id:"abattement-sup\xe9rieur-\xe0-la-valeur",level:4},{value:"Abattement relatif",id:"abattement-relatif",level:4},{value:"plancher",id:"plancher",level:2},{value:"Exemple",id:"exemple-21",level:3},{value:"plafond",id:"plafond",level:2},{value:"Exemple",id:"exemple-22",level:3},{value:"dur\xe9e",id:"dur\xe9e",level:2},{value:"Exemple",id:"exemple-23",level:3},{value:"unit\xe9",id:"unit\xe9",level:2},{value:"Exemple",id:"exemple-24",level:3},{value:"par d\xe9faut",id:"par-d\xe9faut",level:2},{value:"Exemple",id:"exemple-25",level:3},{value:"texte",id:"texte",level:2},{value:"Exemple",id:"exemple-26",level:3},{value:"inversion num\xe9rique",id:"inversion-num\xe9rique",level:2},{value:"r\xe9soudre la r\xe9f\xe9rence circulaire",id:"r\xe9soudre-la-r\xe9f\xe9rence-circulaire",level:2},{value:"Exemple",id:"exemple-27",level:3},{value:"Calcul du revenu professionnel",id:"calcul-du-revenu-professionnel",level:4}],m={toc:p},d="wrapper";function c(e){let{components:n,...a}=e;return(0,t.kt)(d,(0,l.Z)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h2",{id:"applicable-si"},"applicable si"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("p",null,"Renvoie ",(0,t.kt)("inlineCode",{parentName:"p"},"non")," si la condition est \xe9gale \xe0 ",(0,t.kt)("inlineCode",{parentName:"p"},"non"),". Renvoie la valeur sinon."),(0,t.kt)("p",null,"Permet de d\xe9sactiver une r\xe8gle ou une valeur."),(0,t.kt)("h3",{id:"exemple"},"Exemple"),(0,t.kt)(i.Z,{rules:"anciennet\xe9: 4 mois\nprime de vacances:\n  applicable si: anciennet\xe9 >= 1 an\n  valeur: 200\u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"non-applicable-si"},"non applicable si"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("p",null,"Renvoit ",(0,t.kt)("inlineCode",{parentName:"p"},"non")," si la condition n\u2019est pas \xe9gale \xe0 ",(0,t.kt)("inlineCode",{parentName:"p"},"non")),(0,t.kt)("p",null,"Permet de d\xe9sactiver une r\xe8gle ou une valeur."),(0,t.kt)("h3",{id:"exemple-1"},"Exemple"),(0,t.kt)(i.Z,{rules:"anciennet\xe9: 4 mois\nprime de vacances:\n  non applicable si: anciennet\xe9 < 1 an\n  valeur: 200\u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"est-non-d\xe9fini"},"est non d\xe9fini"),(0,t.kt)("p",null,"Renvoit ",(0,t.kt)("inlineCode",{parentName:"p"},"oui")," si la valeur est non d\xe9finie."),(0,t.kt)("h3",{id:"exemple-2"},"Exemple"),(0,t.kt)(i.Z,{rules:"age:\nage inconnu:\n  est non d\xe9fini: age",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"est-d\xe9fini"},"est d\xe9fini"),(0,t.kt)("p",null,"Renvoit ",(0,t.kt)("inlineCode",{parentName:"p"},"oui")," si la valeur est non d\xe9finie."),(0,t.kt)("h3",{id:"exemple-3"},"Exemple"),(0,t.kt)(i.Z,{rules:"age: 15 ans\nage connu:\n  est d\xe9fini: age",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"est-non-applicable"},"est non applicable"),(0,t.kt)("p",null,"Renvoit ",(0,t.kt)("inlineCode",{parentName:"p"},"oui")," si la valeur est non applicable."),(0,t.kt)("admonition",{title:"Note",type:"info"},(0,t.kt)("p",{parentName:"admonition"},"La valeur bool\xe9enne ",(0,t.kt)("inlineCode",{parentName:"p"},"non")," est applicable. Ce m\xe9canisme est donc diff\xe9rent que la comparaison ",(0,t.kt)("inlineCode",{parentName:"p"},"valeur = non"),".\n",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#applicabilit%C3%A9"},"En savoir plus sur l\u2019applicabilit\xe9"))),(0,t.kt)("h3",{id:"exemple-4"},"Exemple"),(0,t.kt)(i.Z,{rules:"exon\xe9rations: oui\nexon\xe9rations . lodeom: non\n\nlodeom non applicable:\n  est non applicable: exon\xe9rations . lodeom",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"est-applicable"},"est applicable"),(0,t.kt)("p",null,"Renvoit ",(0,t.kt)("inlineCode",{parentName:"p"},"oui")," si la valeur est applicable."),(0,t.kt)("admonition",{title:"Note",type:"info"},(0,t.kt)("p",{parentName:"admonition"},"La valeur bool\xe9enne ",(0,t.kt)("inlineCode",{parentName:"p"},"non")," est applicable. Ce m\xe9canisme est donc diff\xe9rent que la comparaison ",(0,t.kt)("inlineCode",{parentName:"p"},"valeur != non"),".\n",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#applicabilit%C3%A9"},"En savoir plus sur l\u2019applicabilit\xe9"))),(0,t.kt)("h3",{id:"exemple-5"},"Exemple"),(0,t.kt)(i.Z,{rules:"exon\xe9rations: oui\nexon\xe9rations . lodeom: non\n\nlodeom applicable:\n  est applicable: exon\xe9rations . lodeom",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"une-de-ces-conditions"},"une de ces conditions"),(0,t.kt)("p",null,"Renvoie ",(0,t.kt)("inlineCode",{parentName:"p"},"oui")," si l\u2019une des r\xe8gles list\xe9es est ",(0,t.kt)("em",{parentName:"p"},"applicable"),"."),(0,t.kt)("p",null,"\xc9quivaut \xe0 un ",(0,t.kt)("inlineCode",{parentName:"p"},"ou")," logique."),(0,t.kt)("h3",{id:"exemple-6"},"Exemple"),(0,t.kt)(i.Z,{rules:"\xe2ge: 17 ans\nmineur \xe9mancip\xe9: oui\nest majeur:\n  une de ces conditions:\n    - \xe2ge >= 18 ans\n    - mineur \xe9mancip\xe9",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"toutes-ces-conditions"},"toutes ces conditions"),(0,t.kt)("p",null,"Renvoie ",(0,t.kt)("inlineCode",{parentName:"p"},"oui")," si toutes toutes les r\xe8gles list\xe9es sont ",(0,t.kt)("em",{parentName:"p"},"applicables"),"."),(0,t.kt)("p",null,"\xc9quivaut \xe0 un ",(0,t.kt)("inlineCode",{parentName:"p"},"et")," logique."),(0,t.kt)("h3",{id:"exemple-7"},"Exemple"),(0,t.kt)(i.Z,{rules:"\xe2ge: 17 ans\ncitoyennet\xe9 fran\xe7aise: oui\npeut voter:\n  toutes ces conditions:\n    - citoyennet\xe9 fran\xe7aise\n    - \xe2ge >= 18 ans",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"produit"},"produit"),(0,t.kt)("p",null,"C\u2019est une multiplication adapt\xe9e pour exprimer au mieux les cotisations."),(0,t.kt)("p",null,"Sa propri\xe9t\xe9 ",(0,t.kt)("inlineCode",{parentName:"p"},"assiette")," est multipli\xe9e par un pourcentage ",(0,t.kt)("inlineCode",{parentName:"p"},"taux"),", ou par un\n",(0,t.kt)("inlineCode",{parentName:"p"},"facteur")," quand ce nom est plus appropri\xe9."),(0,t.kt)("p",null,"La multiplication peut \xeatre plafonn\xe9e : ce plafond s\xe9pare l\u2019assiette en\ndeux, et la partie au-dessus du plafond est tout simplement ignor\xe9e. Dans ce\ncas, elle se comporte comme une bar\xe8me en taux marginaux \xe0 deux tranches, la\ndeuxi\xe8me au taux nul et allant de ",(0,t.kt)("inlineCode",{parentName:"p"},"plafond")," \xe0 l\u2019infini."),(0,t.kt)("h3",{id:"utilisation"},"Utilisation"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},"produit:\n  assiette: <valeur \xe0 multiplier>\n  taux: <taux \xe0 appliquer>\n  facteur: <facteur multiplicatif>\n  plafond: <plafond au-dessus duquel le taux appliqu\xe9 est nul>\n")),(0,t.kt)("h3",{id:"exemple-8"},"Exemple"),(0,t.kt)(i.Z,{rules:"cotisation:\n  produit:\n    assiette: 2000 \u20ac/mois\n    taux: 5%",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"assiette-plafonn\xe9e"},"assiette plafonn\xe9e"),(0,t.kt)(i.Z,{rules:"plafond s\xe9curit\xe9 sociale: 3000 \u20ac/mois\nassiette cotisation: 15000 \u20ac/mois\nch\xf4mage:\n  produit:\n    assiette: assiette cotisation\n    plafond: 400% * plafond s\xe9curit\xe9 sociale\n    taux: 4%",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"variations"},"variations"),(0,t.kt)("p",null,"Contient une liste de conditions (",(0,t.kt)("inlineCode",{parentName:"p"},"si"),") et leurs cons\xe9quences associ\xe9es\n(",(0,t.kt)("inlineCode",{parentName:"p"},"alors"),"), ainsi qu\u2019un cas par d\xe9faut (",(0,t.kt)("inlineCode",{parentName:"p"},"sinon"),")."),(0,t.kt)("p",null,"Pour la premi\xe8re condition vraie dans la liste, on retient la valeur qui lui\nest associ\xe9e."),(0,t.kt)("p",null,"Si aucune condition n\u2019est vraie, alors ce m\xe9canisme renvoie implicitement\n",(0,t.kt)("inlineCode",{parentName:"p"},"non"),"."),(0,t.kt)("p",null,"Ce m\xe9canisme peut aussi \xeatre utilis\xe9 au sein d\u2019un autre m\xe9canisme avec des attributs,\ntel que ",(0,t.kt)("inlineCode",{parentName:"p"},"produit")," ou ",(0,t.kt)("inlineCode",{parentName:"p"},"bar\xe8me"),"."),(0,t.kt)("h3",{id:"utilisation-1"},"Utilisation"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},"- si: <condition \xe0 v\xe9rifier>\n  alors: <consequence \xe9valu\xe9e si la condition est vrai>\n- ...\n- sinon: <consequence \xe9valu\xe9e si aucune des conditions pr\xe9c\xe9dente n'\xe9tait applicable>\n")),(0,t.kt)("h3",{id:"exemple-9"},"Exemple"),(0,t.kt)(i.Z,{rules:"taux r\xe9duit: oui\n\ntaux allocation familiales:\n  variations:\n    - si: taux r\xe9duit\n      alors: 3.45%\n    - sinon: 5.25%",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"dans-un-autre-m\xe9canisme"},"Dans un autre m\xe9canisme"),(0,t.kt)(i.Z,{rules:"assiette cotisation: 2300 \u20ac/mois\ntaux r\xe9duit: oui\nallocation familiales:\n  produit:\n    assiette: assiette cotisation\n    variations:\n    - si: taux r\xe9duit\n      alors:\n        taux: 3.45%\n    - sinon:\n        taux: 5.25%",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"somme"},"somme"),(0,t.kt)("p",null,"Somme de chaque terme de la liste."),(0,t.kt)("p",null,"Si un des termes n\u2019est pas applicable, il vaut z\xe9ro."),(0,t.kt)("p",null,"On peut retrancher des valeurs gr\xe2ce \xe0 l\u2019op\xe9rateur unaire ",(0,t.kt)("inlineCode",{parentName:"p"},"-")),(0,t.kt)("h3",{id:"exemple-10"},"Exemple"),(0,t.kt)(i.Z,{rules:"exemple:\n  somme:\n    - 15.89 \u20ac\n    - 12% * 14 \u20ac\n    - (-20 \u20ac)",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"terme-non-applicable"},"Terme non applicable"),(0,t.kt)(i.Z,{rules:"a: 50 \u20ac\nb:\n  applicable si: non\n  valeur: 20 \u20ac\n\nsomme:\n  somme:\n    - a\n    - b\n    - 40 \u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"moyenne"},"moyenne"),(0,t.kt)("p",null,"Moyenne de chaque terme de la liste."),(0,t.kt)("p",null,"Un terme non applicable n'est pas comptabilis\xe9 dans la moyenne."),(0,t.kt)("h3",{id:"exemple-11"},"Exemple"),(0,t.kt)(i.Z,{rules:"exemple:\n  moyenne:\n    - 15.89 \u20ac\n    - 15% * 14 \u20ac\n    - (-20 \u20ac)",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"terme-non-applicable-1"},"Terme non applicable"),(0,t.kt)(i.Z,{rules:"a: 50 \u20ac\nb:\n  applicable si: non\n  valeur: 20 \u20ac\n\nmoyenne:\n  moyenne:\n    - a\n    - b\n    - 40 \u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"le-maximum-de"},"le maximum de"),(0,t.kt)("p",null,"Renvoie la valeur num\xe9rique de la liste de propositions fournie qui est la\nplus grande."),(0,t.kt)("p",null,"Pour ajouter un plancher \xe0 une valeur, pr\xe9f\xe9rer l\u2019utilisation du\nm\xe9canisme ",(0,t.kt)("inlineCode",{parentName:"p"},"encadrement"),"."),(0,t.kt)("h3",{id:"exemple-12"},"Exemple"),(0,t.kt)(i.Z,{rules:"max:\n  le maximum de:\n    - 50\n    - 100",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"le-minimum-de"},"le minimum de"),(0,t.kt)("p",null,"Renvoie la valeur num\xe9rique de la liste de propositions fournie qui est la\nplus petite."),(0,t.kt)("p",null,"Pour plafonner une valeur, pr\xe9f\xe9rer l\u2019utilisation du m\xe9canisme ",(0,t.kt)("inlineCode",{parentName:"p"},"encadrement"),"."),(0,t.kt)("h3",{id:"exemple-13"},"Exemple"),(0,t.kt)(i.Z,{rules:"min:\n  le minimum de:\n    - 50\n    - 100",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"arrondi"},"arrondi"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("p",null,"Arrondit \xe0 l\u2019entier le plus proche, ou \xe0 une pr\xe9cision donn\xe9e."),(0,t.kt)("h3",{id:"exemple-14"},"Exemple"),(0,t.kt)(i.Z,{rules:"arrondi:\n  arrondi: oui\n  valeur: 12.45",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"nombre-de-d\xe9cimales"},"Nombre de d\xe9cimales"),(0,t.kt)(i.Z,{rules:"arrondi:\n  arrondi: 2 d\xe9cimales\n  valeur: 2 / 3",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"recalcul"},"recalcul"),(0,t.kt)("p",null,"Relance le calcul d\u2019une r\xe8gle dans une situation diff\xe9rente de la situation\ncourante. Permet par exemple de calculer le montant des cotisations au niveau du\nSMIC, m\xeame si le salaire est plus \xe9lev\xe9 dans la situation actuelle."),(0,t.kt)("admonition",{title:"Attention",type:"caution"},(0,t.kt)("p",{parentName:"admonition"},"Les ",(0,t.kt)("strong",{parentName:"p"},"recalculs imbriqu\xe9s")," ne sont pas encore fonctionnels. On parle de recalcul imbriqu\xe9s lorsqu\u2019une variable ",(0,t.kt)("inlineCode",{parentName:"p"},"a")," recalcul une r\xe8gle ",(0,t.kt)("inlineCode",{parentName:"p"},"b")," qui elle m\xeame recalcul la r\xe8gle ",(0,t.kt)("inlineCode",{parentName:"p"},"a"),".")),(0,t.kt)("h3",{id:"exemple-15"},"Exemple"),(0,t.kt)(i.Z,{rules:"brut: 2000\u20ac\n\ncotisations:\n  produit:\n    assiette: brut\n    taux: 20%\n\ncotisations pour un SMIC:\n  recalcul:\n    r\xe8gle: cotisations\n    avec:\n      brut: 1500 \u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"bar\xe8me"},"bar\xe8me"),(0,t.kt)("p",null,"par son utilisation dans le calcul de l\u2019imp\xf4t sur le revenu."),(0,t.kt)("p",null,"L\u2019assiette est d\xe9compos\xe9e en plusieurs tranches, qui sont multipli\xe9es par un\ntaux sp\xe9cifique et enfin additionn\xe9es pour donner le r\xe9sultat."),(0,t.kt)("p",null,"Les tranches sont souvent exprim\xe9es sous forme de facteurs d\u2019une variable\nque l\u2019on appelle ",(0,t.kt)("inlineCode",{parentName:"p"},"multiplicateur"),", par exemple une fois le plafond de la\ns\xe9curit\xe9 sociale."),(0,t.kt)("h3",{id:"exemple-16"},"Exemple"),(0,t.kt)("h4",{id:"sans-multiplicateur"},"Sans multiplicateur"),(0,t.kt)(i.Z,{rules:"revenu imposable: 54126 \u20ac\nimp\xf4t sur le revenu:\n  bar\xe8me:\n    assiette: revenu imposable\n    tranches:\n      - taux: 0%\n        plafond: 9807 \u20ac\n      - taux: 14%\n        plafond: 27086 \u20ac\n      - taux: 30%\n        plafond: 72617 \u20ac\n      - taux: 41%\n        plafond: 153783 \u20ac\n      - taux: 45%",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"avec-multiplicateur"},"Avec multiplicateur"),(0,t.kt)(i.Z,{rules:"assiette retraite: 54004 \u20ac\nplafond s\xe9curit\xe9 sociale: 41136 \u20ac\ncotisation retraite:\n  bar\xe8me:\n    assiette: assiette retraite\n    multiplicateur: plafond s\xe9curit\xe9 sociale\n    tranches:\n      - taux: 17.75%\n        plafond: 1\n      - taux: 0.6%\n  arrondi: oui",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"grille"},"grille"),(0,t.kt)("p",null,"C\u2019est un bar\xe8me sous la forme d\u2019une grille de correspondance simple. C\u2019est\nle m\xe9canisme de calcul de l\u2019imp\xf4t neutre, aussi appel\xe9 imp\xf4t non\npersonnalis\xe9."),(0,t.kt)("p",null,"Il est compos\xe9 de tranches qui se suivent. Il suffit de trouver la tranche qui correspond \xe0 l\u2019assiette, et de selectionner le montant associ\xe9 \xe0 cette tranche."),(0,t.kt)("h3",{id:"exemple-17"},"Exemple"),(0,t.kt)(i.Z,{rules:"SMIC horaire: 10 \u20ac/heures\nrevenu cotis\xe9: 1900\u20ac/an\ntrimestres valid\xe9s:\n  unit\xe9: trimestres valid\xe9s/an\n  grille:\n    assiette: revenu cotis\xe9\n    multiplicateur: SMIC horaire\n    tranches:\n      - montant: 0\n        plafond: 150 heures/an\n      - montant: 1\n        plafond: 300 heures/an\n      - montant: 2\n        plafond: 450 heures/an\n      - montant: 3\n        plafond: 600 heures/an\n      - montant: 4",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"taux-progressif"},"taux progressif"),(0,t.kt)("p",null,"Ce m\xe9canisme permet de calculer un taux progressif. On sp\xe9cifie pour chaque\ntranche le plafond et le taux associ\xe9. Le taux effectif renvoy\xe9 est calcul\xe9\nen lissant la diff\xe9rence de taux entre la borne inf\xe9rieure et sup\xe9rieure de\nl\u2019assiette."),(0,t.kt)("p",null,"Par exemple, si nous nous avons les tranches suivantes :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"taux: 50% / plafond: 0"),(0,t.kt)("li",{parentName:"ul"},"taux: 100% / plafond: 1000")),(0,t.kt)("p",null,"Pour une assiette de 500, le taux retourn\xe9 sera 75%, car il correspond au\ntaux situ\xe9 \xe0 la moiti\xe9 de la tranche correspondante."),(0,t.kt)("h3",{id:"exemple-18"},"Exemple"),(0,t.kt)(i.Z,{rules:"chiffre d'affaires: 30000 \u20ac/an\nplafond: 3000 \u20ac/mois\ntaux r\xe9duction de cotisation:\n  taux progressif:\n    assiette: chiffre d'affaires\n    multiplicateur: plafond\n    tranches:\n      - taux: 100%\n        plafond: 75%\n      - taux: 0%\n        plafond: 100%",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"composantes"},"composantes"),(0,t.kt)("p",null,"Beaucoup de cotisations sont compos\xe9es de deux parties qui partagent la\nm\xe9thode de calcul mais diff\xe8rent selons certains param\xe8tres. Pour ne pas\nd\xe9finir deux variables quasi-redondantes, on utilise ce m\xe9canisme."),(0,t.kt)("p",null,"Cela permet d\u2019avoir une \xe9criture factoris\xe9e, plus facile \xe0 lire."),(0,t.kt)("p",null,"Dans les calculs, ",(0,t.kt)("inlineCode",{parentName:"p"},"composantes")," se comporte ",(0,t.kt)("strong",{parentName:"p"},"exactement comme une somme"),".\nLa documentation, elle, sera adapt\xe9e pour montrer chaque composante."),(0,t.kt)("p",null,"Il est possible par exemple pour le m\xe9canisme ",(0,t.kt)("inlineCode",{parentName:"p"},"produit")," de garder en\ncommun l\u2019assiette, et de d\xe9clarer des composantes pour le taux."),(0,t.kt)("p",null,"Chaque composante peut \xe9galement contenir un champs ",(0,t.kt)("inlineCode",{parentName:"p"},"attributs")," de type objet\ncontenant les m\xe9canismes chain\xe9s \xe0 appliquer \xe0 la composante en question."),(0,t.kt)("p",null,"Lorsque l\u2019on utilise l\u2019attribut ",(0,t.kt)("inlineCode",{parentName:"p"},"nom"),", cela aboutit \xe0 la d\xe9finition de r\xe8gles\nimbriqu\xe9es pour chacun des termes de la somme."),(0,t.kt)("h3",{id:"exemple-19"},"Exemple"),(0,t.kt)(i.Z,{rules:"assiette de base: 2000 \u20ac\ncomposante:\n  produit:\n    assiette: assiette de base\n    composantes:\n      - taux: 2%\n      - taux: 4%\n        plafond: 500 \u20ac",meta:"composante",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"calcul-de-cotisation-avec-part-salariale-et-patronale"},"Calcul de cotisation avec part salariale et patronale"),(0,t.kt)(i.Z,{rules:"assiette de base: 10000 \u20ac\ncotisation 1:\n  produit:\n    assiette: assiette de base\n    composantes:\n    - attributs:\n        nom: employeur\n      taux: 5%\n    - attributs:\n        nom: salari\xe9\n      taux: 1%\n\ncotisations salariales :\n  somme:\n    - cotisation 1 . salari\xe9\n    # ...",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"prix-ht-et-tva"},"Prix HT et TVA"),(0,t.kt)(i.Z,{rules:"prix TTC:\n  produit:\n    assiette: 150\u20ac\n    composantes:\n      - attributs:\n          nom: HT\n      - attributs:\n          nom: TVA\n        taux: 20%",meta:"prix TTC",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"abattement"},"abattement"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("p",null,"Permet de r\xe9duire le montant d\u2019une valeur."),(0,t.kt)("p",null,"Le r\xe9sultat vaudra toujours au moins z\xe9ro, y compris quand le montant de l\u2019abattement est plus grand que le montant abattu."),(0,t.kt)("p",null,"Il est possible d\u2019utiliser le m\xe9canisme ",(0,t.kt)("inlineCode",{parentName:"p"},"abattement")," de deux mani\xe8res :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"soit en indiquant un montant de la m\xeame unit\xe9 que la valeur, qui lui sera alors soustrait"),(0,t.kt)("li",{parentName:"ul"},"soit en indiquant un pourcentage qui sera utilis\xe9 pour calculer l\u2019abattement de mani\xe8re relative")),(0,t.kt)("h3",{id:"exemple-20"},"Exemple"),(0,t.kt)("h4",{id:"abattement-simple"},"Abattement simple"),(0,t.kt)(i.Z,{rules:"revenu imposable:\n  valeur: 10000\u20ac\n  abattement: 2000\u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"abattement-sup\xe9rieur-\xe0-la-valeur"},"Abattement sup\xe9rieur \xe0 la valeur"),(0,t.kt)(i.Z,{rules:"revenu imposable:\n  valeur: 1000\u20ac\n  abattement: 2000\u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"abattement-relatif"},"Abattement relatif"),(0,t.kt)(i.Z,{rules:"revenu imposable:\n  valeur: 2000\u20ac\n  abattement: 10%",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"plancher"},"plancher"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("h3",{id:"exemple-21"},"Exemple"),(0,t.kt)(i.Z,{rules:"revenus: -500\u20ac\nassiette des cotisations:\n  valeur: revenus\n  plancher: 0 \u20ac",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"plafond"},"plafond"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("h3",{id:"exemple-22"},"Exemple"),(0,t.kt)(i.Z,{rules:"d\xe9duction fiscale:\n  valeur: 1300 \u20ac/mois\n  plafond: 200 \u20ac/mois",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"dur\xe9e"},"dur\xe9e"),(0,t.kt)("h3",{id:"exemple-23"},"Exemple"),(0,t.kt)(i.Z,{rules:"date d'embauche: 14/04/2008\nanciennet\xe9 en fin d'ann\xe9e:\n  unit\xe9: an\n  dur\xe9e:\n    depuis: date d'embauche\n    jusqu'\xe0: 31/12/2020",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"unit\xe9"},"unit\xe9"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("p",null,"Permet de convertir explicitement une unit\xe9."),(0,t.kt)("p",null,"Affiche un avertissement si la conversion n\u2019est pas possible \xe0 cause d\u2019unit\xe9s incompatibles."),(0,t.kt)("h3",{id:"exemple-24"},"Exemple"),(0,t.kt)(i.Z,{rules:"salaire:\n  valeur: 35 k\u20ac/an\n  unit\xe9: \u20ac/mois",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"par-d\xe9faut"},"par d\xe9faut"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("p",null,"Permet de donner une valeur par d\xe9faut pour le calcul, sans influer sur les variables manquantes retourn\xe9es."),(0,t.kt)("h3",{id:"exemple-25"},"Exemple"),(0,t.kt)(i.Z,{rules:"prix HT: 50 \u20ac\nprix TTC:\n  assiette: prix HT * (100% + TVA)\nTVA:\n  par d\xe9faut: 20%",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"texte"},"texte"),(0,t.kt)("p",null,"Permet de mettre en forme un texte avec des expressions \xe9valu\xe9e dynamiquement.\nCe principe est connu en informatique sous le nom d\u2019interpolation de chaine de\ncaract\xe8res."),(0,t.kt)("h3",{id:"exemple-26"},"Exemple"),(0,t.kt)(i.Z,{rules:"aide v\xe9lo:\n  texte: >\n    La r\xe9gion subventionne l\u2019achat d\u2019un v\xe9lo \xe0 hauteur de\n    {{ prise en charge }} et jusqu\u2019\xe0 un plafond de {{ plafond }}.\n    Les \xe9ventuelles aides locales d\xe9j\xe0 per\xe7ues sont d\xe9duites de\n    ce montant.\n\n    Par exemple, pour un v\xe9lo de {{ 250 \u20ac }}, la r\xe9gion vous\n    versera {{\n      250 \u20ac * 50%\n    }}.\n\naide v\xe9lo . prise en charge: 50%\naide v\xe9lo . plafond: 500 \u20ac",meta:"aide v\xe9lo",mdxType:"PublicodeExample"}),(0,t.kt)("h2",{id:"inversion-num\xe9rique"},"inversion num\xe9rique"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"M\xe9canisme chainable")," (",(0,t.kt)("a",{parentName:"p",href:"/docs/principes-de-base#m%C3%A9canismes-cha%C3%AEn%C3%A9s"},"plus d\u2019infos"),")")),(0,t.kt)("p",null,"Il est souhaitable de r\xe9diger les r\xe8gles de calcul\nen publicodes de la m\xeame fa\xe7on qu\u2019elles sont d\xe9crites dans la loi ou les\ninterpr\xe9tations administratives ou juridiques existantes. En cons\xe9quence,\ncertaines variables n\u2019auront donc pas de m\xe9thode de calcul clairement\nexplicit\xe9e, il s\u2019agira donc de la d\xe9duire des autres valeurs renseign\xe9es."),(0,t.kt)("p",null,"De fa\xe7on simplifi\xe9e, il s\u2019agira donc, \xe0 partir d\u2019une r\xe8gle existante\nexplicitant ",(0,t.kt)("inlineCode",{parentName:"p"},"y = \u0192(x)")," de calculer ",(0,t.kt)("inlineCode",{parentName:"p"},"x")," \xe0 partir de ",(0,t.kt)("inlineCode",{parentName:"p"},"y"),"."),(0,t.kt)("p",null,"L\u2019inversion num\xe9rique permet d\u2019estimer la valeur de la variable en question\nau plus pr\xe8s \xe0 partir d\u2019un des ",(0,t.kt)("em",{parentName:"p"},"objectifs"),", list\xe9s dans la propri\xe9t\xe9 ",(0,t.kt)("inlineCode",{parentName:"p"},"avec"),".\nIl faut alors renseigner une valeur cible pour ces objectifs."),(0,t.kt)("p",null,"L\u2019algorithme utilis\xe9 est la ",(0,t.kt)("a",{parentName:"p",href:"https://fr.wikipedia.org/wiki/M%C3%A9thode_de_Brent"},"m\xe9thode de\nBrent"),". L\u2019id\xe9e g\xe9n\xe9rale\nest de prendre une valeur au hasard pour la variable en question, et\nd\u2019am\xe9liorer math\xe9matiquement le choix jusqu\u2019\xe0 ce que les valeurs cibles\nsoient toutes suffisamment proches des objectifs."),(0,t.kt)("p",null,"Si on demande au moteur la valeur d\u2019une variable qui a pour formule une\ninversion, il va v\xe9rifier qu\u2019une des variables ",(0,t.kt)("inlineCode",{parentName:"p"},"avec")," a bien une valeur\n(calcul\xe9e ou saisie), et proc\xe9der \xe0 l\u2019inversion d\xe9crite plus haut \xe0 partir\nde celle-ci. Sinon, ces possibilit\xe9s d\u2019inversions seront list\xe9es comme\nmanquantes."),(0,t.kt)("h2",{id:"r\xe9soudre-la-r\xe9f\xe9rence-circulaire"},"r\xe9soudre la r\xe9f\xe9rence circulaire"),(0,t.kt)("p",null,"Active le calcul it\xe9ratif pour trouver la valeur de la r\xe8gle qui r\xe9sout\nla r\xe9f\xe9rence circulaire."),(0,t.kt)("p",null,"Il est possible pour une r\xe8gle de se r\xe9f\xe9rencer elle-m\xeame. Par d\xe9faut, le\nmoteur consid\xe8re qu\u2019il s\u2019agit d\u2019un cycle non voulu, et renvoie \u2018undefined\u2019 comme valeur\npour la r\xe8gle en question, en affichant un avertissement."),(0,t.kt)("p",null,"Mais dans certains cas, la formule est bonne et le cycle est voulu. La valeur de la\nr\xe8gle attendue est donc celle qui r\xe9sout l\u2019\xe9quation obtenue via la r\xe9f\xe9rence cyclique."),(0,t.kt)("p",null,"Lorsque l\u2019on active cette fonctionnalit\xe9, le moteur va proc\xe9der par essai-erreur jusqu\u2019\xe0\ntrouver cette valeur."),(0,t.kt)("p",null,"Note : la r\xe9solution de cycle est co\xfbteuse en temps de calcul. Il faut donc veiller \xe0\nne pas la cumuler avec l\u2019\xe9valuation d\u2019un autre m\xe9canisme co\xfbteux comme l\u2019inversion num\xe9rique\npar exemple."),(0,t.kt)("h3",{id:"exemple-27"},"Exemple"),(0,t.kt)(i.Z,{rules:"x:\n  valeur: 4 * x - 5\n  r\xe9soudre la r\xe9f\xe9rence circulaire: oui",mdxType:"PublicodeExample"}),(0,t.kt)("h4",{id:"calcul-du-revenu-professionnel"},"Calcul du revenu professionnel"),(0,t.kt)(i.Z,{rules:"chiffre d'affaires: 10000 \u20ac/an\n\ncotisations: 25% * revenu professionnel\n\nrevenu professionnel:\n  valeur: chiffre d'affaires - cotisations\n  r\xe9soudre la r\xe9f\xe9rence circulaire: oui",mdxType:"PublicodeExample"}))}c.isMDXComponent=!0},2494:(e,n,a)=>{a.d(n,{Z:()=>l});const l={container:"container_Lusa",button:"button_RcQe",editor:"editor_BeH5"}}}]);
//# sourceMappingURL=5b62c890.05bc6da3.js.map