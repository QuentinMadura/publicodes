"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[694],{5318:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>f});var r=t(7378);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),u=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(o.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(t),m=a,f=d["".concat(o,".").concat(m)]||d[m]||c[m]||i;return t?r.createElement(f,s(s({ref:n},p),{},{components:t})):r.createElement(f,s({ref:n},p))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=m;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[d]="string"==typeof e?e:a,s[1]=l;for(var u=2;u<i;u++)s[u]=t[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6486:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var r=t(5773),a=(t(7378),t(5318));const i={sidebar_position:1,title:"Cr\xe9er un formulaire"},s=void 0,l={unversionedId:"guides/cr\xe9er-formulaire",id:"guides/cr\xe9er-formulaire",title:"Cr\xe9er un formulaire",description:"Publicodes permet de g\xe9n\xe9rer un formulaire int\xe9ractif tout autant qu\u2019un simulateur affichant une liste de questions. Vous pouvez impl\xe9menter l\u2019interface utilisateur la plus adapt\xe9e \xe0 votre application \xe0 partir des informations calcul\xe9es par le moteur.",source:"@site/docs/guides/cr\xe9er-formulaire.mdx",sourceDirName:"guides",slug:"/guides/cr\xe9er-formulaire",permalink:"/docs/guides/cr\xe9er-formulaire",draft:!1,editUrl:"https://github.com/betagouv/publicodes/edit/master/website/docs/guides/cr\xe9er-formulaire.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Cr\xe9er un formulaire"},sidebar:"tutorialSidebar",previous:{title:"Tutoriel",permalink:"/docs/tutoriel"},next:{title:"Cr\xe9er un paquet de r\xe8gles r\xe9utilisable",permalink:"/docs/guides/model-template"}},o={},u=[{value:"Questions et m\xe9ta-donn\xe9es",id:"questions-et-m\xe9ta-donn\xe9es",level:2},{value:"Variables travers\xe9es",id:"variables-travers\xe9es",level:2}],p={toc:u},d="wrapper";function c(e){let{components:n,...t}=e;return(0,a.kt)(d,(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Publicodes permet de g\xe9n\xe9rer un formulaire int\xe9ractif tout autant qu\u2019un simulateur affichant une liste de questions. Vous pouvez impl\xe9menter l\u2019interface utilisateur la plus adapt\xe9e \xe0 votre application \xe0 partir des informations calcul\xe9es par le moteur."),(0,a.kt)("h2",{id:"questions-et-m\xe9ta-donn\xe9es"},"Questions et m\xe9ta-donn\xe9es"),(0,a.kt)("p",null,"Les questions sont d\xe9finies via la cr\xe9ation d'une r\xe8gle publicodes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'age:\n  question: Quel \xe2ge avez-vous ?\n  type: nombre\n\n# La r\xe8gle "age" contient la r\xe9ponse \xe0 la question correspondante\npersonne majeure: age >= 18\n\npr\xe9nom:\n    question: Quel est votre pr\xe9nom ?\n    type: texte\n')),(0,a.kt)("p",null,"On peut filtrer les r\xe8gles publicodes pour obtenir uniquement la liste des questions :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const engine = new Publicodes(rules)\nconst questions = engine.parsedRules.filter(\n    (rule) => rule.rawNode.question !== undefined\n)\n")),(0,a.kt)("p",null,"Vu qu'il s'agit de r\xe8gles publicodes standard, on peut utiliser l'applicabilit\xe9 pour d\xe9terminer la liste des questions \xe0 afficher :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"commande:\ncommande . bi\xe8re:\n    applicable si: personne majeure\n    question: Souhaitez-vous une bi\xe8re ?\n    par d\xe9faut: non\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const questionsToDisplay = questions.filter((question) =>\n    engine.evaluate({ 'est applicable': question })\n)\n")),(0,a.kt)("admonition",{title:"Composants UI pour afficher un formulaire",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Nous ne proposons pas de biblioth\xe8que de composants graphiques directement interfac\xe9s avec Publicodes. En effet sur les diff\xe9rents utilisateurs actuels, le besoin de personnalisation de l'interface est fort, et il n'est pas \xe9vident de d\xe9terminer quels \xe9l\xe9ments partager."),(0,a.kt)("p",{parentName:"admonition"},"Vous devez donc interfacer votre UI avec le moteur Publicodes :"),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Pour lire la valeur courante : ",(0,a.kt)("inlineCode",{parentName:"li"},"engine.evaluate('age')")),(0,a.kt)("li",{parentName:"ul"},"Pour modifier la valeur suite \xe0 une saisie de l'utilisateur : ",(0,a.kt)("inlineCode",{parentName:"li"},"engine.setSituation({ age: 17 })"))),(0,a.kt)("p",{parentName:"admonition"},"\xc0 l\u2019avenir, il est possible que nous exportions des fonctions utilitaires pour simplifier ce travail d\u2019interfa\xe7age.")),(0,a.kt)("h2",{id:"variables-travers\xe9es"},"Variables travers\xe9es"),(0,a.kt)("p",null,"L'utilisation de l'applicabilit\xe9 permet d\xe9j\xe0 d'afficher ou de cacher des questions en fonction des r\xe9ponses pr\xe9c\xe9dentes. Mais pour certains formulaires par nature tr\xe8s dynamiques, on veut en plus pouvoir ordonner automatiquement les questions."),(0,a.kt)("p",null,"L\xe0 encore, l'impl\xe9mentation concr\xe8te d\xe9pendra de chaque application. Mais g\xe9n\xe9ralement il faudra prendre en compte les d\xe9pendences entre les questions. Ainsi dans l'exemple ci-dessus, on veut d'abord d\xe9terminer si la personne est majeure avant de lui demander s'il elle veut commander une bi\xe8re. Il faut donc poser la question de l'\xe2ge en premier."),(0,a.kt)("p",null,"Pour exploiter cette notion de d\xe9pendance des questions, on peut utiliser les ",(0,a.kt)("strong",{parentName:"p"},"variables travers\xe9es"),". Les variables travers\xe9es sont une m\xe9ta-donn\xe9e retourn\xe9e lors de l'\xe9valuation d'une expression publicodes qui permet de conna\xeetre l'ensemble des r\xe8gles qui interviennent dans son calcul."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"commande . vin:\n    applicable si:\n        toutes ces conditions:\n            - personne majeure\n            - bi\xe8re = non\n    question: Voulez-vous une bouteille de rouge ?\n    par d\xe9faut: non\n")),(0,a.kt)("p",null,"On peut \xe9valuer la r\xe8gle ",(0,a.kt)("inlineCode",{parentName:"p"},"commande . vin")," pour d\xe9terminer sa valeur actuelle ainsi que les variables utilis\xe9es dans le calcul :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const commandeVin = engine.evaluate('commande . vin')\nconsole.log(commandeVin.nodeValue) // false - la valeur par d\xe9faut\nconsole.log(commandeVin.traversedVariables) // [ 'personne majeure', 'bi\xe8re' ]\n")),(0,a.kt)("p",null,"Les variables travers\xe9es sont retourn\xe9es dans leur ordre d\u2019apparition. Ainsi par exemple les r\xe8gles r\xe9f\xe9renc\xe9es dans le m\xe9canisme ",(0,a.kt)("a",{parentName:"p",href:"/docs/api/m%C3%A9canismes#applicable-si"},"applicable si")," appara\xeetront avant celles utilis\xe9es dans le calcul de la valeur de la r\xe8gle en elle-m\xeame, en effet publicodes \xe9value d'abord la condition avant d'\xe9valuer le cas \xe9ch\xe9ant la cons\xe9quence."),(0,a.kt)("p",null,"\xc0 noter que les variables travers\xe9es d\xe9pendent de la situation courante."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# Les variables travers\xe9es lors de l'\xe9valuation de `chauffage` d\xe9pendent\n# de la valeur courante de `chauffage . type\nchauffage:\n    variations:\n    - si: type = 'buche'\n        alors: type . buche . consommation * facteur . buche\n    - sinon: type . granul\xe9s . consommation * facteur . granul\xe9s\n\nchauffage . type:\n    par d\xe9faut: \"'buche'\"\n")),(0,a.kt)("admonition",{title:"Variables manquantes",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Publicodes calcule \xe9galement une liste de \xab variables manquantes \xbb. Il s'agit d'un sous-ensemble des variables travers\xe9es filter uniquement sur les r\xe8gles qui n'ont pas de formule (ou uniquement une formule par d\xe9faut)."),(0,a.kt)("p",{parentName:"admonition"},"Avant l'introduction des variables travers\xe9es il s'agissait de la seule meta-donn\xe9e calcul\xe9e permettant de d\xe9terminer l'ordre des r\xe8gles."),(0,a.kt)("p",{parentName:"admonition"},"Il semble maintenant pr\xe9f\xe9rable de se baser sur les variables travers\xe9es, et de les filtrer sur le sous-ensemble de r\xe8gles pertinent pour l'application : par exemple la liste des questions.")))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=e1ab8497.7091ad6b.js.map